console.time('Built folder.css file!');

var fs = require('fs-extra');
var DataURI = require('datauri').sync;
var CleanCSS = require('clean-css');
var index = fs.readFileSync('index.html', 'utf8');
var cheerio = require('cheerio');
var $ = cheerio.load(index);
var css = $('style').first().html();
var images = fs.readdirSync(__dirname);

images.forEach(function(name){
  
  if (css.indexOf(name) === -1) return;

  var uri = DataURI(name);

  css = css.split(name).join(uri);
});

css = new CleanCSS().minify(css).styles;

fs.writeFileSync('folder.css', css, 'utf8');

console.timeEnd('Built folder.css file!');